import{defineComponent as e,ref as t,inject as o,provide as a,watch as n,h as s,computed as r,onMounted as d,onBeforeUnmount as l,Teleport as c}from"vue";const i=Symbol();const p=new class{events;ymapReady;scriptIsNotAttached;pluginInstalledGlobal;constructor(){this.events={},this.ymapReady=!1,this.scriptIsNotAttached=!0,this.pluginInstalledGlobal=!1}$on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter((e=>t!==e))}}$emit(e){const t=this.events[e];t&&t.forEach((e=>e()))}};function u(e){return new Promise(((t,o)=>{if(window.ymaps)return t(!0);if(document.getElementById("vue-yandex-maps-script"))return void p.$on("scriptIsLoaded",t);const a=document.createElement("SCRIPT"),{apiKey:n="",lang:s="ru_RU",version:r="2.1",coordorder:d="latlong",debug:l=!1,enterprise:c=!1}=e,i=`https://${c?"enterprise.":""}api-maps.yandex.ru/${r}/?${`lang=${s}${n&&`&apikey=${n}`}&mode=${l?"debug":"release"}&coordorder=${d}`}`;a.setAttribute("src",i),a.setAttribute("async",""),a.setAttribute("defer",""),a.setAttribute("id","vue-yandex-maps-script"),document.head.appendChild(a),p.scriptIsNotAttached=!1,a.onload=(e=>()=>{ymaps.ready((()=>{p.ymapReady=!0,p.$emit("scriptIsLoaded"),e(!0)}))})(t),a.onerror=o}))}const m=e=>Array.isArray(e)?e.map(m):+e,b=["actionbegin","actionbreak","actionend","actiontick","actiontickcomplete","balloonclose","balloonopen","boundschange","click","contextmenu","dblclick","destroy","hintclose","hintopen","marginchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","sizechange","typechange","wheel"],y=["balloonclose","balloonopen","beforedrag","beforedragstart","click","contextmenu","dblclick","drag","dragend","dragstart","editorstatechange","geometrychange","hintclose","hintopen","mapchange","mousedown","mouseenter","mouseleave","mousemove","mouseup","multitouchend","multitouchmove","multitouchstart","optionschange","overlaychange","parentchange","propertieschange","wheel"];function h(e,t=!1){const o=[],a=[];let n,s;return{addGeoObject:(a,s)=>{o.push(t?s:a),clearTimeout(n),n=window.setTimeout((()=>e(o,"add")))},deleteGeoObject:(o,n)=>{a.push(t?n:o),clearTimeout(s),s=window.setTimeout((()=>e(a,"remove")))}}}var g=e({name:"YandexMap",props:{coordinates:{type:Array,required:!0},zoom:{type:Number,default:10},bounds:{type:Array,default:null},behaviors:{type:Array,default:null},controls:{type:Array,default:null},detailedControls:{type:Object,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>b.includes(e)))},mapType:{type:String,default:"map"},settings:{type:Object,default:()=>({})},panOptions:{type:Object,default:void 0}},emits:[...b,"geo-objects-updated","created"],setup(e,{emit:r,slots:d,expose:l}){const c=t(!1),m=p.pluginInstalledGlobal&&o("pluginOptions")||{};let b;const y=`yandexMap${Math.round(1e5*Math.random())}`,{addGeoObject:g,deleteGeoObject:j}=h(((e,t)=>{b&&e.length&&(e.forEach((e=>b?.geoObjects[t](e))),r("geo-objects-updated",b.geoObjects),e=[])}));a(i,{addGeoObject:g,deleteGeoObject:j});const v=()=>{if(c.value=!0,b=new ymaps.Map(y,{center:e.coordinates,zoom:e.zoom,bounds:e.bounds,behaviors:e.behaviors,controls:e.controls,type:`yandex#${e.mapType}`}),e.events.forEach((e=>b?.events?.add(e,(t=>r(e,t))))),e.detailedControls){Object.keys(e.detailedControls).forEach((t=>{b?.controls.remove(t),b?.controls.add(t,e.detailedControls?.[t])}))}r("created",b)};if(p.scriptIsNotAttached){u({...m,...e.settings})}return p.ymapReady?ymaps.ready(v):p.$on("scriptIsLoaded",v),l(b),n((()=>e.coordinates),(t=>b?.panTo(t,e.panOptions))),n((()=>e.zoom),(e=>b?.setZoom(e))),n((()=>e.bounds),(e=>b?.setBounds(e))),n((()=>e.mapType),(e=>b?.setType(e))),()=>s("section",{class:"yandex-container","data-test":"map"},[s("div",{id:y,style:"min-height: 100%;"}),c.value&&s("div",{style:"display: none;"},[d.default?.()])])}}),j=e({name:"YandexMarker",props:{coordinates:{type:Array,required:!0},markerId:{type:[String,Number],required:!0},properties:{type:Object,default:()=>({})},options:{type:Object,default:null},type:{type:String,default:"Point"},radius:{type:Number,default:null},events:{type:Array,default:()=>["click"],validator:e=>e.every((e=>y.includes(e)))}},emits:[...y],setup(e,{emit:p,slots:u,expose:b}){const{addGeoObject:y,deleteGeoObject:h}=o(i)||{},g=r((()=>e.coordinates.map(m))),j=t(!1),v={geometry:{type:e.type,coordinates:g.value,radius:e.radius},properties:{...e.properties,markerId:e.markerId}},O=u.component?.().length?ymaps.templateLayoutFactory.createClass(`<div id="balloon-${e.markerId}" class="yandex-balloon"><div>`,{build(){O.superclass.build.call(this),j.value=!0},clear(){j.value=!1,O.superclass.clear.call(this)}}):null,f={balloonContentLayout:O,...e.options},G=new ymaps.GeoObject(v,f);e.events.forEach((e=>G.events?.add(e,(t=>p(e,t))))),a("marker",G);const x={...v,options:f};return d((()=>{y(G,x)})),l((()=>{h(G,x)})),n((()=>e.coordinates),(e=>{G.geometry?.setCoordinates?.(e)})),b(G),u.component?.().length?()=>j.value&&s(c,{to:`#balloon-${e.markerId}`},[u.component?.()]):()=>u.default?.()}}),v=e({name:"YandexGeoObjectCollection",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const r=new ymaps.GeoObjectCollection({},e.options),{addGeoObject:c,deleteGeoObject:p}=o(i)||{},{addGeoObject:u,deleteGeoObject:m}=h(((e,o)=>{r&&e.length&&(e.forEach((e=>r[o](e))),t("geo-objects-updated",r),e=[])}));return a(i,{addGeoObject:u,deleteGeoObject:m}),d((()=>{c(r)})),l((()=>{p(r)})),n(r),()=>s.default?.()}}),O=e({name:"YandexClusterer",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const r=new ymaps.Clusterer(e.options),{addGeoObject:c,deleteGeoObject:p}=o(i)||{},{addGeoObject:u,deleteGeoObject:m}=h(((e,o)=>{r&&e.length&&(r[o](e),t("geo-objects-updated",r),e=[])}));return a(i,{addGeoObject:u,deleteGeoObject:m}),d((()=>{c(r)})),l((()=>{p(r)})),n(r),()=>s.default?.()}}),f=e({name:"YandexObjectManager",props:{options:{type:Object,default:()=>({})}},emits:["geo-objects-updated"],setup(e,{emit:t,expose:n,slots:s}){const r=new ymaps.ObjectManager(e.options),{addGeoObject:c,deleteGeoObject:p}=o(i)||{},{addGeoObject:u,deleteGeoObject:m}=h(((e,o)=>{if(!r||!e.length)return;const a=e.map((e=>({type:"Feature",id:e.properties.markerId,geometry:e.geometry,properties:e.properties,options:e.options})));r[o](a),t("geo-objects-updated",r),e=[]}),!0);return a(i,{addGeoObject:u,deleteGeoObject:m}),d((()=>{c(r)})),l((()=>{p(r)})),n(r),()=>s.default?.()}});let G;const x=u,k=g,I=j,w=v,A=O,$=f;var C={install:(e,t)=>{G||(G=!0,p.pluginInstalledGlobal=!0,e.provide("pluginOptions",t),e.component("YandexMap",g),e.component("YandexMarker",j),e.component("YandexCollection",v),e.component("YandexClusterer",O),e.component("YandexObjectManager",f))}};export{A as YandexClusterer,w as YandexCollection,k as YandexMap,I as YandexMarker,$ as YandexObjectManager,C as default,x as loadYmap};
//# sourceMappingURL=vue-yandex-maps.umd.js.map
